#include <string.h>
#include <stdlib.h>

#include "chip8_types.h"
#include "memory.h"
#include "constants.h"

byte font_bytes[] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0,  // 0
    0x20, 0x60, 0x20, 0x20, 0x70,  // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0,  // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0,  // 3
    0x90, 0x90, 0xF0, 0x10, 0x10,  // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0,  // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0,  // 6
    0xF0, 0x10, 0x20, 0x40, 0x40,  // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0,  // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0,  // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90,  // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0,  // B
    0xF0, 0x80, 0x80, 0x80, 0xF0,  // C
    0xE0, 0x90, 0x90, 0x90, 0xE0,  // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0,  // E
    0xF0, 0x80, 0xF0, 0x80, 0x80   // F
};

chip8_memory *create_memory(int size) {
    if (size < MIN_MEMORY_SIZE || size > MAX_MEMORY_SIZE) {
        return NULL;
    }

    chip8_memory *memory = malloc(sizeof(chip8_memory));
    memory->memory = malloc(sizeof(chip8_memory_cell_t) * size);
    memory->size = size;

    memset(memory->memory, 0, sizeof(chip8_memory_cell_t) * size);
    memcpy(memory->memory, font_bytes, sizeof(byte) * 4 * 16);

    return memory;
}

void delete_memory(chip8_memory *memory) {
    free(memory->memory);
    free(memory);
}